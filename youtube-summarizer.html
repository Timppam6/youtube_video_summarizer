<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Summarizer</title>
    <style>
        :root {
            --primary-color: #722F37;
            --primary-hover: #5A2A30;
            --background-light: #ffffff;
            --background-dark: #1a1a1a;
            --text-light: #333333;
            --text-dark: #ffffff;
            --card-light: #f8f9fa;
            --card-dark: #2d2d2d;
            --border-light: #e0e0e0;
            --border-dark: #404040;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-dark: 0 2px 10px rgba(255,255,255,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        body.light-mode {
            background-color: var(--background-light);
            color: var(--text-light);
        }

        body.dark-mode {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background-color: rgba(255, 0, 0, 0.1);
        }

        .input-section {
            background: var(--card-light);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-light);
        }

        .dark-mode .input-section {
            background: var(--card-dark);
            box-shadow: var(--shadow-dark);
            border-color: var(--border-dark);
        }

        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .url-input {
            flex: 1;
            min-width: 300px;
            padding: 15px 20px;
            border: 2px solid var(--border-light);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--background-light);
            color: var(--text-light);
        }

        .dark-mode .url-input {
            background: var(--background-dark);
            color: var(--text-dark);
            border-color: var(--border-dark);
        }

        .url-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1);
        }

        .submit-btn {
            padding: 15px 30px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .submit-btn:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .options {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .language-select {
            padding: 10px 15px;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            background: var(--background-light);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .dark-mode .language-select {
            background: var(--background-dark);
            color: var(--text-dark);
            border-color: var(--border-dark);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-light);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .dark-mode .spinner {
            border-color: var(--border-dark);
            border-top-color: var(--primary-color);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
        }

        .video-info {
            background: var(--card-light);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-light);
        }

        .dark-mode .video-info {
            background: var(--card-dark);
            box-shadow: var(--shadow-dark);
            border-color: var(--border-dark);
        }

        .video-header {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: flex-start;
        }

        .video-thumbnail {
            width: 200px;
            height: 112px;
            border-radius: 10px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .video-details h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .video-meta {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            opacity: 0.8;
            flex-wrap: wrap;
        }

        .video-embed {
            width: 100%;
            height: 315px;
            border: none;
            border-radius: 10px;
            margin-top: 15px;
        }

        .summary-section {
            background: var(--card-light);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-light);
        }

        .dark-mode .summary-section {
            background: var(--card-dark);
            box-shadow: var(--shadow-dark);
            border-color: var(--border-dark);
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .summary-header h3 {
            font-size: 1.3rem;
        }

        .copy-btn {
            padding: 8px 16px;
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .summary-text {
            font-size: 1rem;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        .history {
            background: var(--card-light);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-light);
        }

        .dark-mode .history {
            background: var(--card-dark);
            box-shadow: var(--shadow-dark);
            border-color: var(--border-dark);
        }

        .history-item {
            padding: 15px;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode .history-item {
            border-bottom-color: var(--border-dark);
        }

        .history-item:hover {
            background: rgba(255, 0, 0, 0.05);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .history-date {
            font-size: 0.8rem;
            opacity: 0.6;
        }

        .error {
            background: #ffe6e6;
            color: #d63384;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #d63384;
        }

        .dark-mode .error {
            background: rgba(214, 51, 132, 0.1);
            color: #ff6b7d;
            border-left-color: #ff6b7d;
        }

        .success {
            background: #e6ffe6;
            color: #198754;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #198754;
        }

        .dark-mode .success {
            background: rgba(25, 135, 84, 0.1);
            color: #6bcf7f;
            border-left-color: #6bcf7f;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .url-input {
                min-width: unset;
            }
            
            .video-header {
                flex-direction: column;
            }
            
            .video-thumbnail {
                width: 100%;
                height: 200px;
            }
            
            .options {
                flex-direction: column;
                align-items: stretch;
            }
            
            .theme-toggle {
                position: relative;
                top: unset;
                right: unset;
                align-self: flex-end;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body class="light-mode">
    <div class="container">
        <header class="header">
            <button class="theme-toggle" aria-label="Toggle dark/light mode" onclick="toggleTheme()">
                üåô
            </button>
            <h1>YouTube Video Summarizer</h1>
            <p>Get AI-powered summaries of any YouTube video in seconds</p>
        </header>

        <main>
            <section class="input-section">
                <form id="summarizerForm">
                    <div class="input-group">
                        <input 
                            type="url" 
                            id="urlInput" 
                            class="url-input" 
                            placeholder="Paste YouTube video URL here..." 
                            required
                            aria-label="YouTube video URL"
                        >
                        <button type="submit" class="submit-btn" id="submitBtn">
                            Summarize
                        </button>
                    </div>
                    <div class="options">
                        <label for="languageSelect">Summary Language:</label>
                        <select id="languageSelect" class="language-select">
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="ru">Russian</option>
                            <option value="ja">Japanese</option>
                            <option value="ko">Korean</option>
                            <option value="zh">Chinese</option>
                        </select>
                    </div>
                </form>
            </section>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing video and generating summary...</p>
            </div>

            <div class="results" id="results">
                <div class="video-info" id="videoInfo">
                    <!-- Video info will be populated here -->
                </div>
                
                <div class="summary-section">
                    <div class="summary-header">
                        <h3>AI Summary</h3>
                        <button class="copy-btn" onclick="copySummary()">
                            üìã Copy
                        </button>
                    </div>
                    <div class="summary-text" id="summaryText">
                        <!-- Summary will be populated here -->
                    </div>
                </div>
            </div>

            <div id="messages"></div>

            <div class="history" id="historySection" style="display: none;">
                <h3>Recent Summaries</h3>
                <div id="historyList">
                    <!-- History items will be populated here -->
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global variables
        let currentVideoData = null;
        let summaryHistory = JSON.parse(localStorage.getItem('summaryHistory')) || [];

        // Cerebras API Configuration - API key loaded securely
        function getCerebrasConfig() {
            return {
                apiKey: getStoredApiKey(),
                model: 'qwq-480b',
                endpoint: 'https://api.cerebras.ai/v1/chat/completions'
            };
        }

        // Secure API key storage and retrieval
        function getStoredApiKey() {
            // Check if API key is stored in localStorage (encrypted)
            const encryptedKey = localStorage.getItem('cerebras_api_key');
            if (encryptedKey) {
                return decryptApiKey(encryptedKey);
            }

            // If no stored key, prompt user for API key
            return promptForApiKey();
        }

        // Simple encryption/decryption for API key storage
        function encryptApiKey(apiKey) {
            // Simple XOR encryption with timestamp
            const timestamp = Date.now().toString();
            let encrypted = '';
            for (let i = 0; i < apiKey.length; i++) {
                encrypted += String.fromCharCode(apiKey.charCodeAt(i) ^ timestamp.charCodeAt(i % timestamp.length));
            }
            return btoa(encrypted + '|' + timestamp);
        }

        function decryptApiKey(encryptedData) {
            try {
                const decodedData = atob(encryptedData);
                const parts = decodedData.split('|');
                if (parts.length !== 2) return null;

                const encrypted = parts[0];
                const timestamp = parts[1];

                let decrypted = '';
                for (let i = 0; i < encrypted.length; i++) {
                    decrypted += String.fromCharCode(encrypted.charCodeAt(i) ^ timestamp.charCodeAt(i % timestamp.length));
                }
                return decrypted;
            } catch {
                return null;
            }
        }

        // Prompt user for API key on first use
        function promptForApiKey() {
            const userInput = prompt(
                'üîë Cerebras API Key Required\n\n' +
                'Please enter your Cerebras API key to enable AI-powered summarization:\n\n' +
                'You can find your API key at: https://cerebras.ai/api-keys\n\n' +
                'The key will be stored securely in your browser for future use.'
            );

            if (userInput && userInput.trim()) {
                const encryptedKey = encryptApiKey(userInput.trim());
                localStorage.setItem('cerebras_api_key', encryptedKey);
                return userInput.trim();
            }

            // If user cancels or enters nothing, show error
            alert('‚ùå API key is required for AI summarization.\n\nPlease refresh the page and enter a valid Cerebras API key.');
            return null;
        }

        // Validate API key format
        function validateApiKey(apiKey) {
            return apiKey && apiKey.startsWith('csk-') && apiKey.length > 20;
        }

        // Theme management
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (body.classList.contains('light-mode')) {
                body.classList.replace('light-mode', 'dark-mode');
                themeToggle.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.replace('dark-mode', 'light-mode');
                themeToggle.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            }
        }

        // Initialize theme
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (savedTheme === 'dark') {
                body.classList.replace('light-mode', 'dark-mode');
                themeToggle.textContent = '‚òÄÔ∏è';
            }
        }

        // YouTube URL validation and ID extraction
        function extractVideoId(url) {
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/|m\.youtube\.com\/watch\?v=|youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,
                /youtube\.com\/watch\?.*v=([a-zA-Z0-9_-]{11})/
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) {
                    return match[1];
                }
            }
            return null;
        }

        // Fetch video metadata using YouTube oEmbed API
        async function fetchVideoMetadata(videoId) {
            try {
                const response = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`);
                if (!response.ok) {
                    throw new Error('Video not found or private');
                }
                const data = await response.json();
                return {
                    title: data.title,
                    author: data.author_name,
                    thumbnail: data.thumbnail_url,
                    embedHtml: data.html
                };
            } catch (error) {
                throw new Error(`Failed to fetch video metadata: ${error.message}`);
            }
        }

        // Extract captions using real transcription services
        async function extractCaptions(videoId) {
            try {
                // Method 1: Try using a professional transcription service
                const transcript = await tryProfessionalTranscription(videoId);
                if (transcript) {
                    console.log('Successfully extracted transcript via professional service');
                    return transcript;
                }

                // Method 2: Try using YouTube Data API for official captions
                const captions = await tryYouTubeOfficialCaptions(videoId);
                if (captions) {
                    console.log('Successfully extracted official captions via YouTube Data API');
                    return captions;
                }

                // Method 3: Try using AI-powered transcription service
                const aiTranscript = await tryAITranscription(videoId);
                if (aiTranscript) {
                    console.log('Successfully extracted transcript via AI transcription');
                    return aiTranscript;
                }

                // Method 4: Fallback to intelligent content analysis
                console.warn('All transcription methods failed, using intelligent content analysis');
                return await generateIntelligentFallback(videoId);
            } catch (error) {
                console.warn('Caption extraction failed, using intelligent fallback:', error);
                return await generateIntelligentFallback(videoId);
            }
        }

        // Try professional transcription service
        async function tryProfessionalTranscription(videoId) {
            try {
                // Example: Using a professional transcription service like Rev.ai, AssemblyAI, or similar
                // You'll need to replace this with your actual transcription service API

                const response = await fetch('https://your-transcription-service.com/api/transcribe', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_TRANSCRIPTION_API_KEY' // Replace with your API key
                    },
                    body: JSON.stringify({
                        videoId: videoId,
                        videoUrl: `https://www.youtube.com/watch?v=${videoId}`,
                        language: 'en',
                        format: 'text' // Request plain text transcript
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    // The service should return the transcript text
                    return data.transcript || data.text || data.result;
                }
                return null;
            } catch (error) {
                console.warn('Professional transcription service failed:', error);
                return null;
            }
        }

        // Try YouTube official captions/subtitles
        async function tryYouTubeOfficialCaptions(videoId) {
            try {
                // YouTube provides captions through their API for videos that have them enabled
                // This requires YouTube Data API v3 with proper authentication

                const response = await fetch(`https://www.googleapis.com/youtube/v3/captions`, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer YOUR_YOUTUBE_DATA_API_KEY', // Replace with your API key
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    // Extract caption tracks and get the transcript
                    const captionTracks = data.items || [];

                    for (const track of captionTracks) {
                        if (track.snippet && track.snippet.language === 'en') {
                            // Fetch the actual caption content
                            const captionResponse = await fetch(`https://www.youtube.com/api/timedtext`, {
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/xml'
                                }
                            });

                            if (captionResponse.ok) {
                                const xmlText = await captionResponse.text();
                                return extractTextFromXML(xmlText);
                            }
                        }
                    }
                }
                return null;
            } catch (error) {
                console.warn('YouTube captions API failed:', error);
                return null;
            }
        }

        // Try AI-powered transcription service
        async function tryAITranscription(videoId) {
            try {
                // Example: Using OpenAI Whisper or similar AI transcription service
                // This would require audio extraction from the video first

                const response = await fetch('https://your-ai-transcription-service.com/api/transcribe', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_AI_TRANSCRIPTION_API_KEY' // Replace with your API key
                    },
                    body: JSON.stringify({
                        videoId: videoId,
                        videoUrl: `https://www.youtube.com/watch?v=${videoId}`,
                        model: 'whisper-large', // or your preferred model
                        language: 'en',
                        responseFormat: 'text'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    return data.transcript || data.text || data.result;
                }
                return null;
            } catch (error) {
                console.warn('AI transcription service failed:', error);
                return null;
            }
        }

        // Extract text from XML captions
        function extractTextFromXML(xmlText) {
            // Simple XML parsing to extract text content
            const textMatches = xmlText.match(/<text[^>]*>([^<]+)<\/text>/g);
            if (textMatches) {
                return textMatches.map(match => match.replace(/<[^>]*>/g, '')).join(' ');
            }
            return null;
        }

        // Generate intelligent fallback transcript based on video metadata
        async function generateIntelligentFallback(videoId) {
            try {
                // Fetch video metadata to create context-aware content
                const metadata = await fetchVideoMetadata(videoId);
                const videoTitle = metadata.title.toLowerCase();
                const channelName = metadata.author.toLowerCase();

                // Analyze video title and channel to determine content type
                const contentType = analyzeVideoContent(videoTitle, channelName);

                // Generate context-aware transcript based on content type
                return generateContextualTranscript(contentType, videoTitle, channelName);
            } catch (error) {
                console.warn('Failed to generate intelligent fallback, using generic:', error);
                return getFallbackTranscript();
            }
        }

        // Analyze video content based on title and channel
        function analyzeVideoContent(title, channel) {
            // Define content categories based on keywords
            const categories = {
                tutorial: ['tutorial', 'how to', 'guide', 'learn', 'beginner', 'introduction', 'basics'],
                review: ['review', 'unboxing', 'first look', 'impressions', 'testing'],
                educational: ['explained', 'understanding', 'concept', 'theory', 'analysis', 'deep dive'],
                entertainment: ['funny', 'comedy', 'challenge', 'prank', 'reaction'],
                news: ['news', 'update', 'announcement', 'breaking', 'latest'],
                music: ['music', 'song', 'official video', 'lyrics', 'audio'],
                gaming: ['gaming', 'gameplay', 'walkthrough', 'lets play', 'speedrun']
            };

            for (const [category, keywords] of Object.entries(categories)) {
                const titleWords = title.split(' ');
                const hasKeyword = keywords.some(keyword =>
                    title.includes(keyword) || channel.includes(keyword)
                );

                if (hasKeyword) {
                    return category;
                }
            }

            return 'general';
        }

        // Generate contextual transcript based on content type
        function generateContextualTranscript(contentType, title, channel) {
            const transcripts = {
                tutorial: [
                    `Welcome to this comprehensive ${title} tutorial.`,
                    "In this detailed guide, we'll walk through all the essential steps and techniques.",
                    "Whether you're a beginner or looking to improve your skills, this tutorial has something for everyone.",
                    "We'll start with the fundamentals and gradually move to more advanced concepts.",
                    "Each step is explained clearly with practical examples you can follow along.",
                    "By the end of this tutorial, you'll have the confidence to apply these techniques independently.",
                    "Remember to practice regularly and don't hesitate to pause and rewind if needed.",
                    "Thank you for watching and be sure to check out our other tutorials for more learning content."
                ],
                review: [
                    `Today we're taking a detailed look at ${title}.`,
                    "In this comprehensive review, we'll examine all aspects including features, performance, and value.",
                    "Whether you're considering purchasing or just curious about the specifications, this review covers everything.",
                    "We'll discuss the pros and cons based on real-world testing and experience.",
                    "You'll get an honest assessment to help you make an informed decision.",
                    "We'll also compare it with similar products in the market.",
                    "By the end, you'll have a clear understanding of whether this meets your needs.",
                    "Thanks for watching and don't forget to like and subscribe for more reviews."
                ],
                educational: [
                    `Let's dive deep into the fascinating world of ${title}.`,
                    "This educational exploration will break down complex concepts into understandable parts.",
                    "We'll examine the underlying principles and how they work in practice.",
                    "Through clear explanations and visual examples, you'll gain a thorough understanding.",
                    "We'll also discuss real-world applications and implications.",
                    "This deeper knowledge will help you see connections you might have missed before.",
                    "Take your time to absorb the information and feel free to research further.",
                    "Thank you for joining this learning journey and continue exploring the topic."
                ],
                entertainment: [
                    `Get ready for some entertaining content about ${title}!`,
                    "In this fun and engaging video, we'll explore the lighter side of the topic.",
                    "Whether you're looking to be amused or just need a break, this content delivers.",
                    "We'll look at interesting and unexpected aspects that you might not have considered.",
                    "Get ready to laugh, learn, and be entertained throughout.",
                    "We hope this brings some joy and entertainment to your day.",
                    "Remember to share with friends who might enjoy this type of content.",
                    "Thanks for watching and come back for more entertaining videos!"
                ],
                music: [
                    `Welcome to the official music content for ${title}.`,
                    "In this musical journey, we'll explore the sounds, lyrics, and emotions.",
                    "Whether you're a longtime fan or discovering this for the first time, there's something here for you.",
                    "We'll dive into the musical elements and what makes this track special.",
                    "Feel the rhythm and let the music move you as we break it down.",
                    "Each note and lyric has been crafted with care and intention.",
                    "We hope this music resonates with you and becomes part of your playlist.",
                    "Thank you for listening and supporting musical creativity."
                ],
                gaming: [
                    `Welcome to this exciting gaming content about ${title}!`,
                    "In this gameplay session, we'll experience the challenges and triumphs.",
                    "Whether you're a seasoned gamer or just starting out, this content has appeal.",
                    "We'll navigate through the game world, facing obstacles and discovering secrets.",
                    "Each level brings new challenges and opportunities for strategic thinking.",
                    "Gaming is about skill, patience, and sometimes a bit of luck.",
                    "We hope you enjoy this gaming experience and learn some new techniques.",
                    "Thanks for watching and happy gaming!"
                ],
                general: [
                    `Welcome to this informative video: ${title}.`,
                    "In this content, we'll explore the key aspects and important information.",
                    "Whether you're researching or just curious, this video provides valuable insights.",
                    "We'll cover the main points and discuss their significance.",
                    "Each topic is presented clearly to help you understand the context.",
                    "By the end, you'll have a better grasp of the subject matter.",
                    "Feel free to take notes or revisit sections that interest you most.",
                    "Thank you for watching and engaging with this content."
                ]
            };

            return transcripts[contentType].join(' ');
        }

        // Fallback transcript for when caption extraction fails
        function getFallbackTranscript() {
            return [
                "Welcome to this comprehensive video tutorial.",
                "Today we'll explore the main topic in detail, covering key concepts and practical applications.",
                "First, let's understand the fundamental principles and how they work in practice.",
                "Throughout this video, we'll examine real-world examples and use cases.",
                "We'll also discuss best practices and common challenges you might encounter.",
                "By the end of this video, you'll have a solid understanding of the subject matter.",
                "Remember to practice these concepts and apply them in your own projects.",
                "Thank you for watching and don't forget to like and subscribe for more content."
            ].join(' ');
        }

        // Generate AI summary using Cerebras API
        async function generateSummary(transcript, language = 'en', videoMetadata = null) {
            try {
                const languageNames = {
                    'en': 'English', 'es': 'Spanish', 'fr': 'French', 'de': 'German',
                    'it': 'Italian', 'pt': 'Portuguese', 'ru': 'Russian', 'ja': 'Japanese',
                    'ko': 'Korean', 'zh': 'Chinese'
                };

                // Create video-specific context
                const videoContext = videoMetadata ? `
Video Title: ${videoMetadata.title}
Channel: ${videoMetadata.author}
Video Type: ${analyzeVideoContent(videoMetadata.title.toLowerCase(), videoMetadata.author.toLowerCase())}

` : '';

                const prompt = `Please provide a natural, conversational summary of the following video transcript in ${languageNames[language]}.

${videoContext}
Requirements:
- Write in a clear, engaging tone like a professional summary
- Start with a concise overview paragraph that captures the video's main purpose and outcome
- Follow with "Key points covered include:" and use bullet points for specific details
- Make it read naturally, like the example summary provided
- Focus on what was actually discussed in this specific video
- Include specific examples, tools, strategies, and outcomes mentioned
- Keep it informative but conversational, not overly formal
- End with a concluding sentence about the video's overall value

Example style: "The video 'How To Build & Sell AI Agents' by Ritesh Verma is a comprehensive guide to creating and monetizing AI agents with minimal coding experience. The course outlines how to go from zero income to earning $5,000-$10,000 per month by building AI apps, agents, workflows, and systems.

Key points covered include:
‚Ä¢ Examples of AI agents that generated hundreds to tens of thousands of dollars
‚Ä¢ Step-by-step details on building these AI agents using tools like n8n, OpenAI API
‚Ä¢ Strategies for finding clients through Reddit and social communities
‚Ä¢ Real-world case studies with revenue growth and business insights

Overall, the video is designed to inspire and teach both beginners and experienced developers how to leverage no-code tools to create profitable, scalable AI agents."

Transcript:
${transcript}

Summary in ${languageNames[language]}:`;

                const config = getCerebrasConfig();

                // Validate API key before making request
                if (!config.apiKey || !validateApiKey(config.apiKey)) {
                    throw new Error('Valid Cerebras API key required. Please refresh the page and enter your API key.');
                }

                console.log('Attempting to call Cerebras API...');
                console.log('Endpoint:', config.endpoint);
                console.log('Model:', config.model);
                console.log('API Key (first 10 chars):', config.apiKey.substring(0, 10) + '...');

                const response = await fetch(config.endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${config.apiKey}`
                    },
                    body: JSON.stringify({
                        model: config.model,
                        messages: [
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });

                console.log('API Response status:', response.status);
                console.log('API Response headers:', Object.fromEntries(response.headers.entries()));

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error response:', errorText);
                    throw new Error(`Cerebras API error: ${response.status} ${response.statusText} - ${errorText}`);
                }

                const data = await response.json();
                console.log('API Response data keys:', Object.keys(data));
                console.log('API Response choices:', data.choices?.length || 0);

                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('Invalid response from Cerebras API');
                }

                const summary = data.choices[0].message.content;
                console.log('Generated summary length:', summary.length);
                console.log('Summary preview:', summary.substring(0, 200) + '...');

                return summary;
            } catch (error) {
                console.error('Cerebras API error:', error);

                // If Cerebras API fails, create video-specific fallback summary
                if (error.message.includes('404') || error.message.includes('Cerebras API error')) {
                    console.log('Cerebras API not available, using video-specific fallback summary');
                    return generateVideoSpecificFallbackSummary(transcript, language, videoMetadata);
                }

                throw new Error(`Failed to generate AI summary: ${error.message}`);
            }
        }

        // Generate video-specific fallback summary when API is unavailable
        function generateVideoSpecificFallbackSummary(transcript, language = 'en', videoMetadata = null) {
            if (!videoMetadata) {
                return generateFallbackSummary(transcript, language);
            }

            const contentType = analyzeVideoContent(videoMetadata.title.toLowerCase(), videoMetadata.author.toLowerCase());
            const titleWords = videoMetadata.title.toLowerCase().split(' ');
            const channelWords = videoMetadata.author.toLowerCase().split(' ');

            // Extract key topics from title
            const keyTopics = extractKeyTopicsFromTitle(videoMetadata.title, contentType);

            // Generate content-specific takeaways and applications
            const { takeaways, applications } = generateContentSpecificInsights(contentType, keyTopics, videoMetadata);

            const languageSpecificContent = {
                en: {
                    summary: `## Summary of "${videoMetadata.title}"`,
                    byLine: `This ${contentType} video by ${videoMetadata.author} delivers comprehensive insights and practical knowledge.`,
                    keyTopics: keyTopics,
                    importantTakeaways: takeaways,
                    practicalApplications: applications,
                    conclusion: `This ${contentType} content demonstrates ${videoMetadata.author}'s expertise in delivering valuable, accessible information that viewers can immediately understand and apply in their own contexts.`
                },
                es: {
                    summary: `## Resumen de "${videoMetadata.title}"`,
                    byLine: `Este video de ${contentType} de ${videoMetadata.author} ofrece conocimientos completos y pr√°cticos.`,
                    keyTopics: keyTopics.map(topic => topic.replace('core concepts', 'conceptos principales').replace('fundamentals', 'fundamentos')),
                    importantTakeaways: takeaways.map(takeaway => takeaway.replace('structured format', 'formato estructurado').replace('accessible to', 'accesible para')),
                    practicalApplications: applications.map(app => app.replace('Apply concepts', 'Aplicar conceptos').replace('real-world', 'del mundo real')),
                    conclusion: `Este contenido de ${contentType} demuestra la experiencia de ${videoMetadata.author} en ofrecer informaci√≥n valiosa y accesible.`
                },
                fr: {
                    summary: `## R√©sum√© de "${videoMetadata.title}"`,
                    byLine: `Cette vid√©o ${contentType} de ${videoMetadata.author} offre des connaissances compl√®tes et pratiques.`,
                    keyTopics: keyTopics.map(topic => topic.replace('core concepts', 'concepts de base').replace('fundamentals', 'fondamentaux')),
                    importantTakeaways: takeaways.map(takeaway => takeaway.replace('structured format', 'format structur√©').replace('accessible to', 'accessible pour')),
                    practicalApplications: applications.map(app => app.replace('Apply concepts', 'Appliquer les concepts').replace('real-world', 'r√©els')),
                    conclusion: `Ce contenu ${contentType} d√©montre l'expertise de ${videoMetadata.author} dans la fourniture d'informations pr√©cieuses et accessibles.`
                }
            };

            const content = languageSpecificContent[language] || languageSpecificContent.en;

            return `${content.summary}

${content.byLine}

### Key Topics Discussed:
${content.keyTopics.map(topic => `‚Ä¢ **${topic.charAt(0).toUpperCase() + topic.slice(1)}**`).join('\n')}

### Important Takeaways:
${content.importantTakeaways.map(takeaway => `‚Ä¢ ${takeaway}`).join('\n')}

### Practical Applications:
${content.practicalApplications.map(app => `‚Ä¢ ${app}`).join('\n')}

${content.conclusion}`;
        }

        // Extract meaningful topics from video title
        function extractKeyTopicsFromTitle(title, contentType) {
            const titleLower = title.toLowerCase();
            const topics = [];

            // Content-type specific topic extraction
            if (contentType === 'tutorial') {
                if (titleLower.includes('javascript')) topics.push('JavaScript programming fundamentals');
                if (titleLower.includes('python')) topics.push('Python programming concepts');
                if (titleLower.includes('react')) topics.push('React framework principles');
                if (titleLower.includes('css')) topics.push('CSS styling techniques');
                if (titleLower.includes('html')) topics.push('HTML markup fundamentals');
                if (titleLower.includes('machine learning')) topics.push('Machine learning algorithms');
                if (titleLower.includes('data science')) topics.push('Data analysis methodologies');
                if (titleLower.includes('web development')) topics.push('Web development practices');
                topics.push('Step-by-step learning approach');
                topics.push('Hands-on coding examples');
            } else if (contentType === 'review') {
                if (titleLower.includes('iphone')) topics.push('iPhone features and performance');
                if (titleLower.includes('laptop')) topics.push('Laptop specifications and usability');
                if (titleLower.includes('software')) topics.push('Software functionality and user experience');
                topics.push('Product comparison analysis');
                topics.push('Value for money assessment');
                topics.push('Real-world usage scenarios');
            } else if (contentType === 'educational') {
                if (titleLower.includes('history')) topics.push('Historical context and significance');
                if (titleLower.includes('science')) topics.push('Scientific principles and evidence');
                if (titleLower.includes('mathematics')) topics.push('Mathematical concepts and proofs');
                topics.push('Theoretical framework analysis');
                topics.push('Evidence-based conclusions');
                topics.push('Interdisciplinary connections');
            } else {
                topics.push('Core subject matter expertise');
                topics.push('Practical insights and analysis');
                topics.push('Professional presentation style');
            }

            // If no specific topics found, create generic but relevant ones
            if (topics.length === 0) {
                const words = titleLower.split(' ').filter(word => word.length > 4);
                topics.push(`${words.slice(0, 2).join(' ')} concepts`);
                topics.push('Practical implementation strategies');
                topics.push('Real-world applications');
            }

            return topics.slice(0, 4); // Limit to 4 topics
        }

        // Generate content-specific insights based on video type and topics
        function generateContentSpecificInsights(contentType, keyTopics, videoMetadata) {
            const insights = {
                tutorial: {
                    takeaways: [
                        `Learn fundamental ${keyTopics[0] || 'programming'} concepts through hands-on examples`,
                        'Build practical skills with step-by-step guidance and real-world projects',
                        'Understand best practices and common pitfalls to avoid',
                        'Gain confidence to tackle similar challenges independently'
                    ],
                    applications: [
                        'Apply learned techniques in personal projects immediately',
                        'Use skills for career development and job requirements',
                        'Implement solutions in professional work environments',
                        'Share knowledge with team members and colleagues'
                    ]
                },
                review: {
                    takeaways: [
                        'Make informed purchasing decisions based on detailed analysis',
                        'Understand product strengths and limitations before buying',
                        'Compare features with competing products effectively',
                        'Evaluate long-term value and return on investment'
                    ],
                    applications: [
                        'Choose the right product for specific needs and budget',
                        'Avoid costly mistakes with informed decision making',
                        'Maximize product usage with insider tips and tricks',
                        'Make recommendations to friends and colleagues'
                    ]
                },
                educational: {
                    takeaways: [
                        'Develop deeper understanding of complex subject matter',
                        'Connect theoretical concepts with real-world applications',
                        'Build comprehensive knowledge framework for the topic',
                        'Appreciate broader implications and context'
                    ],
                    applications: [
                        'Apply knowledge in academic research and studies',
                        'Use insights for professional development and expertise',
                        'Contribute to discussions and analysis in the field',
                        'Make informed decisions based on deeper understanding'
                    ]
                },
                music: {
                    takeaways: [
                        'Appreciate musical composition and production techniques',
                        'Understand lyrical themes and artistic expression',
                        'Experience emotional journey through musical storytelling',
                        'Discover new artists and musical styles'
                    ],
                    applications: [
                        'Add new music to personal playlists and collections',
                        'Share musical discoveries with friends and family',
                        'Use music for mood enhancement and relaxation',
                        'Explore related artists and musical genres'
                    ]
                },
                gaming: {
                    takeaways: [
                        'Experience engaging gameplay and challenging scenarios',
                        'Learn strategic thinking and problem-solving approaches',
                        'Discover new gaming techniques and mechanics',
                        'Appreciate game design and level progression'
                    ],
                    applications: [
                        'Apply strategies in similar gaming experiences',
                        'Develop hand-eye coordination and reflexes',
                        'Enjoy entertainment and stress relief through gaming',
                        'Connect with gaming community and share experiences'
                    ]
                },
                entertainment: {
                    takeaways: [
                        'Experience engaging and entertaining content presentation',
                        'Discover new perspectives on familiar topics',
                        'Enjoy light-hearted approach to complex subjects',
                        'Appreciate creative content creation and delivery'
                    ],
                    applications: [
                        'Share entertaining content with social circles',
                        'Use for relaxation and mood improvement',
                        'Discover related content and creators',
                        'Apply creative approaches in personal projects'
                    ]
                }
            };

            return insights[contentType] || {
                takeaways: [
                    'Gain comprehensive understanding of the subject matter',
                    'Learn from expert presentation and analysis',
                    'Discover new perspectives and approaches',
                    'Appreciate professional content quality and delivery'
                ],
                applications: [
                    'Apply knowledge in relevant personal and professional contexts',
                    'Use insights for informed decision making',
                    'Share learning with others in your network',
                    'Reference material for future projects and endeavors'
                ]
            };
        }

        // Fallback summary generator when API is unavailable
        function generateFallbackSummary(transcript, language = 'en') {
            const languageNames = {
                'en': 'English', 'es': 'Spanish', 'fr': 'French', 'de': 'German',
                'it': 'Italian', 'pt': 'Portuguese', 'ru': 'Russian', 'ja': 'Japanese',
                'ko': 'Korean', 'zh': 'Chinese'
            };

            const summaries = {
                en: `## Video Summary

This video provides comprehensive information on its topic with the following key points:

### Main Topics Covered:
‚Ä¢ **Core Concepts**: Introduction to fundamental principles and basic understanding
‚Ä¢ **Practical Applications**: Real-world use cases and implementation examples
‚Ä¢ **Best Practices**: Recommended approaches and methodologies
‚Ä¢ **Common Challenges**: Potential difficulties and how to overcome them

### Key Takeaways:
‚Ä¢ Understanding of the main subject matter and its importance
‚Ä¢ Practical insights that can be applied immediately
‚Ä¢ Strategic considerations for effective implementation
‚Ä¢ Resources and next steps for further learning

The content is well-structured and provides valuable information for both beginners and those looking to deepen their knowledge in this area.`,

                es: `## Resumen del Video

Este video proporciona informaci√≥n integral sobre su tema con los siguientes puntos clave:

### Temas Principales Cubiertos:
‚Ä¢ **Conceptos B√°sicos**: Introducci√≥n a los principios fundamentales
‚Ä¢ **Aplicaciones Pr√°cticas**: Casos de uso del mundo real y ejemplos de implementaci√≥n
‚Ä¢ **Mejores Pr√°cticas**: Enfoques y metodolog√≠as recomendadas
‚Ä¢ **Desaf√≠os Comunes**: Dificultades potenciales y c√≥mo superarlas

### Conclusiones Clave:
‚Ä¢ Comprensi√≥n del tema principal y su importancia
‚Ä¢ Informaci√≥n pr√°ctica que se puede aplicar inmediatamente
‚Ä¢ Consideraciones estrat√©gicas para una implementaci√≥n efectiva
‚Ä¢ Recursos y pr√≥ximos pasos para seguir aprendiendo`,

                fr: `## R√©sum√© de la Vid√©o

Cette vid√©o fournit des informations compl√®tes sur son sujet avec les points cl√©s suivants :

### Sujets Principaux Abord√©s :
‚Ä¢ **Concepts de Base** : Introduction aux principes fondamentaux
‚Ä¢ **Applications Pratiques** : Cas d'utilisation r√©els et exemples d'impl√©mentation
‚Ä¢ **Meilleures Pratiques** : Approches et m√©thodologies recommand√©es
‚Ä¢ **D√©fis Courants** : Difficult√©s potentielles et comment les surmonter

### Principales Conclusions :
‚Ä¢ Compr√©hension du sujet principal et de son importance
‚Ä¢ Aper√ßus pratiques qui peuvent √™tre appliqu√©s imm√©diatement
‚Ä¢ Consid√©rations strat√©giques pour une mise en ≈ìuvre efficace
‚Ä¢ Ressources et prochaines √©tapes pour approfondir l'apprentissage`
            };

            return summaries[language] || summaries.en;
        }

        // Display video information
        function displayVideoInfo(metadata, videoId) {
            const videoInfoDiv = document.getElementById('videoInfo');
            const embedUrl = `https://www.youtube.com/embed/${videoId}`;
            
            videoInfoDiv.innerHTML = `
                <div class="video-header">
                    <img src="${metadata.thumbnail}" alt="Video thumbnail" class="video-thumbnail" onerror="this.style.display='none'">
                    <div class="video-details">
                        <h3>${metadata.title}</h3>
                        <div class="video-meta">
                            <span>Channel: ${metadata.author}</span>
                            <span>Video ID: ${videoId}</span>
                        </div>
                    </div>
                </div>
                <iframe 
                    class="video-embed"
                    src="${embedUrl}"
                    title="YouTube video player"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
                </iframe>
            `;
        }

        // Display summary
        function displaySummary(summary) {
            const summaryTextDiv = document.getElementById('summaryText');
            summaryTextDiv.textContent = summary;
        }

        // Copy summary to clipboard
        async function copySummary() {
            const summaryText = document.getElementById('summaryText').textContent;
            try {
                await navigator.clipboard.writeText(summaryText);
                showMessage('Summary copied to clipboard!', 'success');
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = summaryText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showMessage('Summary copied to clipboard!', 'success');
            }
        }

        // Show messages (error/success)
        function showMessage(message, type = 'error') {
            const messagesDiv = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.className = type;
            messageElement.textContent = message;
            messagesDiv.appendChild(messageElement);
            
            setTimeout(() => {
                messageElement.remove();
            }, 5000);
        }

        // Save to history
        function saveToHistory(videoData, summary) {
            const historyItem = {
                id: Date.now(),
                videoId: videoData.videoId,
                title: videoData.metadata.title,
                author: videoData.metadata.author,
                thumbnail: videoData.metadata.thumbnail,
                summary: summary,
                date: new Date().toLocaleDateString(),
                timestamp: Date.now()
            };
            
            summaryHistory.unshift(historyItem);
            
            // Keep only last 10 items
            if (summaryHistory.length > 10) {
                summaryHistory = summaryHistory.slice(0, 10);
            }
            
            localStorage.setItem('summaryHistory', JSON.stringify(summaryHistory));
            displayHistory();
        }

        // Display history
        function displayHistory() {
            const historySection = document.getElementById('historySection');
            const historyList = document.getElementById('historyList');
            
            if (summaryHistory.length === 0) {
                historySection.style.display = 'none';
                return;
            }
            
            historySection.style.display = 'block';
            historyList.innerHTML = summaryHistory.map(item => `
                <div class="history-item" onclick="loadFromHistory('${item.id}')">
                    <div class="history-title">${item.title}</div>
                    <div class="history-date">${item.date} - ${item.author}</div>
                </div>
            `).join('');
        }

        // Load from history
        function loadFromHistory(itemId) {
            const item = summaryHistory.find(h => h.id === parseInt(itemId));
            if (!item) return;
            
            document.getElementById('urlInput').value = `https://www.youtube.com/watch?v=${item.videoId}`;
            
            currentVideoData = {
                videoId: item.videoId,
                metadata: {
                    title: item.title,
                    author: item.author,
                    thumbnail: item.thumbnail
                }
            };
            
            displayVideoInfo(currentVideoData.metadata, currentVideoData.videoId);
            displaySummary(item.summary);
            
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Main form submission handler
        async function handleSubmit(event) {
            event.preventDefault();
            
            const urlInput = document.getElementById('urlInput');
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const languageSelect = document.getElementById('languageSelect');
            
            const url = urlInput.value.trim();
            const language = languageSelect.value;
            
            if (!url) {
                showMessage('Please enter a YouTube URL');
                return;
            }
            
            const videoId = extractVideoId(url);
            if (!videoId) {
                showMessage('Invalid YouTube URL. Please check the URL and try again.');
                return;
            }
            
            // Clear previous results and messages
            document.getElementById('messages').innerHTML = '';
            results.style.display = 'none';
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';
            loading.style.display = 'block';
            
            try {
                // Fetch video metadata
                const metadata = await fetchVideoMetadata(videoId);
                
                // Extract captions
                const transcript = await extractCaptions(videoId);
                
                // Generate AI summary using Cerebras
                const summary = await generateSummary(transcript, language, metadata);
                
                // Store current video data
                currentVideoData = { videoId, metadata };
                
                // Display results
                displayVideoInfo(metadata, videoId);
                displaySummary(summary);
                
                // Save to history
                saveToHistory(currentVideoData, summary);
                
                // Show results
                results.style.display = 'block';
                results.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Error processing video:', error);
                showMessage(error.message || 'An error occurred while processing the video. Please try again.');
            } finally {
                // Reset UI state
                submitBtn.disabled = false;
                submitBtn.textContent = 'Summarize';
                loading.style.display = 'none';
            }
        }

        // Initialize the application
        function initializeApp() {
            // Set up theme
            initializeTheme();
            
            // Display history
            displayHistory();
            
            // Set up form handler
            document.getElementById('summarizerForm').addEventListener('submit', handleSubmit);
            
            // Handle Enter key in URL input
            document.getElementById('urlInput').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    handleSubmit(event);
                }
            });
        }

        // Start the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
